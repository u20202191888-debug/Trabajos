<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Miner√≠a Nacional</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
  <nav class="sidebar">
    <h2><i class="fas fa-gem"></i> Miner√≠a CO</h2>
    <ul>
      <li><a href="index.html"><i class="fas fa-home"></i> Principal</a></li>
      <li><a href="departamentos.html"><i class="fas fa-map-marker-alt"></i> Por Departamento</a></li>
      <li><a href="nacional.html"><i class="fas fa-flag"></i> Nacional</a></li>
    </ul>
  </nav>

  <main class="content">
    <h1><i class="fas fa-flag"></i> Estad√≠sticas Nacionales</h1>
    <p>Principales minerales a nivel nacional y departamentos con mayor producci√≥n.</p>
    <canvas id="graficoTopNacional"></canvas>
    <canvas id="graficoDepartamentosTop"></canvas>
  </main>

  <script>

    if (typeof Chart === 'undefined') {
      console.error("‚ùå Error: Chart.js no se ha cargado correctamente.");
    } else {
      console.log("‚úÖ Chart.js cargado correctamente.");
    }

    document.addEventListener("DOMContentLoaded", () => {
      Papa.parse("datos/mineria.csv", {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: function(results) {
          console.log("üìÇ Datos cargados del CSV:", results.data);

          const data = results.data;
          const minerales = {};
          const departamentos = {};

          data.forEach(row => {
            let mineral = row["Recurso Natural"] || row["Recurso_Natural"];
            let dep = row["Departamento"];
            let cantidadStr = row["Cantidad Producci√≥n"] || row["Cantidad Produccion"] || "0";
            let produccion = parseFloat(cantidadStr.replace(/,/g, "")) || 0;

            if (mineral) {
              minerales[mineral] = (minerales[mineral] || 0) + produccion;
            }
            if (dep) {
              departamentos[dep] = (departamentos[dep] || 0) + produccion;
            }
          });

          console.log("üìä Minerales agrupados por producci√≥n:", minerales);
          console.log("üìä Departamentos agrupados por producci√≥n:", departamentos);


          const topMinerales = Object.entries(minerales)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 10);

          const labelsMinerales = topMinerales.map(item => item[0]);
          const valoresMinerales = topMinerales.map(item => item[1]);

          console.log("üîù Top 10 Minerales:", topMinerales);

          new Chart(document.getElementById("graficoTopNacional"), {
            type: "line",
            data: {
              labels: labelsMinerales,
              datasets: [{
                label: "Producci√≥n Total de Minerales",
                data: valoresMinerales,
                borderColor: "rgba(231, 76, 60, 0.9)",
                backgroundColor: "rgba(231, 76, 60, 0.7)",
                fill: false,
                showLine: true, 
                pointRadius: 8,
                pointHoverRadius: 12
              }]
            },
            options: {
              responsive: true,
              plugins: {
                tooltip: {
                  callbacks: {
                    label: (context) => `${labelsMinerales[context.dataIndex]}: ${context.raw.toLocaleString()}`
                  }
                }
              },
              scales: {
                x: {
                  title: { display: true, text: "Minerales" }
                },
                y: {
                  beginAtZero: true,
                  title: { display: true, text: "Producci√≥n Total" }
                }
              }
            }
          });

          const depEntries = Object.entries(departamentos).sort((a, b) => b[1] - a[1]);
          const labelsDeps = depEntries.map(item => item[0]);
          const valoresDeps = depEntries.map(item => item[1]);

          console.log("üîù Departamentos con mayor producci√≥n:", depEntries);

          new Chart(document.getElementById("graficoDepartamentosTop"), {
            type: "bar",
            data: {
              labels: labelsDeps,
              datasets: [{
                label: "Producci√≥n por Departamento",
                data: valoresDeps,
                backgroundColor: "rgba(52, 152, 219, 0.7)"
              }]
            },
            options: {
              responsive: true,
              plugins: {
                legend: { display: false }
              },
              scales: {
                x: { title: { display: true, text: "Departamentos" } },
                y: { beginAtZero: true, title: { display: true, text: "Producci√≥n Total" } }
              }
            }
          });
        },
        error: function(err) {
          console.error("‚ùå Error al cargar el CSV:", err);
        }
      });
    });
  </script>
</body>
</html>
